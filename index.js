(()=>{"use strict";class t{static projection(t,o,e){return[2/t,0,0,0,0,-2/o,0,0,0,0,2/e,0,-1,1,0,1]}static perspective(t,o,e,n){const i=Math.tan(.5*Math.PI-.5*t),r=1/(e-n);return[i/o,0,0,0,0,i,0,0,0,0,(e+n)*r,-1,0,0,e*n*r*2,0]}static multiply(t,o){const e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],s=t[5],c=t[6],l=t[7],h=t[8],u=t[9],p=t[10],d=t[11],v=t[12],x=t[13],m=t[14],b=t[15],f=o[0],y=o[1],g=o[2],_=o[3],z=o[4],M=o[5],R=o[6],w=o[7],S=o[8],E=o[9],A=o[10],C=o[11],F=o[12],L=o[13],P=o[14],k=o[15];return[f*e+y*a+g*h+_*v,f*n+y*s+g*u+_*x,f*i+y*c+g*p+_*m,f*r+y*l+g*d+_*b,z*e+M*a+R*h+w*v,z*n+M*s+R*u+w*x,z*i+M*c+R*p+w*m,z*r+M*l+R*d+w*b,S*e+E*a+A*h+C*v,S*n+E*s+A*u+C*x,S*i+E*c+A*p+C*m,S*r+E*l+A*d+C*b,F*e+L*a+P*h+k*v,F*n+L*s+P*u+k*x,F*i+L*c+P*p+k*m,F*r+L*l+P*d+k*b]}static inverse(t){const o=t[0],e=t[1],n=t[2],i=t[3],r=t[4],a=t[5],s=t[6],c=t[7],l=t[8],h=t[9],u=t[10],p=t[11],d=t[12],v=t[13],x=t[14],m=t[15],b=u*m,f=x*p,y=s*m,g=x*c,_=s*p,z=u*c,M=n*m,R=x*i,w=n*p,S=u*i,E=n*c,A=s*i,C=l*v,F=d*h,L=r*v,P=d*a,k=r*h,$=l*a,j=o*v,O=d*e,T=o*h,D=l*e,B=o*a,U=r*e,q=b*a+g*h+_*v-(f*a+y*h+z*v),I=f*e+M*h+S*v-(b*e+R*h+w*v),N=y*e+R*a+E*v-(g*e+M*a+A*v),G=z*e+w*a+A*h-(_*e+S*a+E*h),Q=1/(o*q+r*I+l*N+d*G);return[Q*q,Q*I,Q*N,Q*G,Q*(f*r+y*l+z*d-(b*r+g*l+_*d)),Q*(b*o+R*l+w*d-(f*o+M*l+S*d)),Q*(g*o+M*r+A*d-(y*o+R*r+E*d)),Q*(_*o+S*r+E*l-(z*o+w*r+A*l)),Q*(C*c+P*p+k*m-(F*c+L*p+$*m)),Q*(F*i+j*p+D*m-(C*i+O*p+T*m)),Q*(L*i+O*c+B*m-(P*i+j*c+U*m)),Q*($*i+T*c+U*p-(k*i+D*c+B*p)),Q*(L*u+$*x+F*s-(k*x+C*s+P*u)),Q*(T*x+C*n+O*u-(j*u+D*x+F*n)),Q*(j*s+U*x+P*n-(B*x+L*n+O*s)),Q*(B*u+k*n+D*s-(T*s+U*u+$*n))]}static translation(t,o,e){return[1,0,0,0,0,1,0,0,0,0,1,0,t,o,e,1]}static xRotation(t){const o=Math.cos(t),e=Math.sin(t);return[1,0,0,0,0,o,e,0,0,-e,o,0,0,0,0,1]}static yRotation(t){const o=Math.cos(t),e=Math.sin(t);return[o,0,-e,0,0,1,0,0,e,0,o,0,0,0,0,1]}static zRotation(t){const o=Math.cos(t),e=Math.sin(t);return[o,e,0,0,-e,o,0,0,0,0,1,0,0,0,0,1]}static scaling(t,o,e){return[t,0,0,0,0,o,0,0,0,0,e,0,0,0,0,1]}static translate(o,e,n,i){return t.multiply(o,t.translation(e,n,i))}static xRotate(o,e){return t.multiply(o,t.xRotation(e))}static yRotate(o,e){return t.multiply(o,t.yRotation(e))}static zRotate(o,e){return t.multiply(o,t.zRotation(e))}static scale(o,e,n,i){return t.multiply(o,t.scaling(e,n,i))}static transformVector(t,o){let e=[];for(let n=0;n<4;++n){e[n]=0;for(let i=0;i<4;++i)e[n]+=o[i]*t[4*i+n]}return e}}const o=t,e=class{constructor(t,o){this.options={width:500,height:500,backgroundColor:[0,0,0,1]},this.$canvas=t,this.context=this.$canvas.getContext("webgl2"),this.options=Object.assign(Object.assign({},this.options),o),this.resizeCanvas(),this.clearCanvas()}renderTriangles(t,o,e,n){const{attributesData:i,verticesCount:r}=t,a=this.createProgram(this.createShader(WebGL2RenderingContext.VERTEX_SHADER,o),this.createShader(WebGL2RenderingContext.FRAGMENT_SHADER,e));this.context.useProgram(a);const s=this.context.getUniformLocation(a,"u_matrix");this.context.uniformMatrix4fv(s,!1,n),Object.keys(i).map((t=>{this.createBuffer(i[t].vertices);const o=this.context.getAttribLocation(a,t);this.context.vertexAttribPointer(o,i[t].vertexSize,this.context.FLOAT,!1,0,0),this.context.enableVertexAttribArray(o)})),this.context.drawArrays(this.context.TRIANGLES,0,r)}resizeCanvas(){const{width:t,height:o}=this.options;this.$canvas.width=t,this.$canvas.height=o,this.context.viewport(0,0,t,o)}clearCanvas(){this.context.clearColor(...this.options.backgroundColor),this.context.clearDepth(1),this.context.enable(this.context.DEPTH_TEST),this.context.depthFunc(this.context.LEQUAL),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)}createShader(t,o){const e=this.context.createShader(t);return this.context.shaderSource(e,o),this.context.compileShader(e),this.context.getShaderParameter(e,this.context.COMPILE_STATUS)?e:(console.log(this.context.getShaderInfoLog(e)),this.context.deleteShader(e),null)}createProgram(t,o){const e=this.context.createProgram();return this.context.attachShader(e,t),this.context.attachShader(e,o),this.context.linkProgram(e),this.context.getProgramParameter(e,this.context.LINK_STATUS)?e:(console.log(this.context.getProgramInfoLog(e)),this.context.deleteProgram(e),null)}createBuffer(t){const o=this.context.createBuffer();return this.context.bindBuffer(this.context.ARRAY_BUFFER,o),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array(t),this.context.STATIC_DRAW),o}};class n{}n.vertexShader="#version 300 es\nin vec4 a_position;\nin vec4 a_color;\n\nuniform mat4 u_matrix;\n\nout vec4 vertex_Color;\n\nvoid main() {\n  gl_Position = u_matrix * a_position;\n\n  vertex_Color = a_color;\n}\n  ",n.fragmentShader="#version 300 es\n  precision highp float;\n\n  in vec4 vertex_Color;\n  \n  out vec4 outColor;\n \n  void main() {\n    outColor = vertex_Color;\n  }\n";const i=n;function r(t){return t*Math.PI/180}function a(t){const e=o.translate(o.xRotation(Math.PI),-50,-75,-15);for(var n=0;n<t.length;n+=3){var i=o.transformVector(e,[t[n+0],t[n+1],t[n+2],1]);t[n+0]=i[0],t[n+1]=i[1],t[n+2]=i[2]}return t}function s(t,o){const[e,n]=t.reduce(((t,o)=>[[...t[0],...o.verticesPositions[0],...o.verticesPositions[1],...o.verticesPositions[2]],[...t[1],...o.color,...o.color,...o.color]]),[[],[]]);return{attributesData:{a_color:{vertices:n,vertexSize:4},a_position:{vertices:a(e),vertexSize:o}},verticesCount:e.length/o,position:t[0].position,rotation:t[0].rotation}}function c(t,o){const e=[[0,0,0],[0,100,0],[100,100,0],[100,0,0]];return s(t.reduce(((t,o)=>[...t,Object.assign(Object.assign({},o),{verticesPositions:(o.verticesPositions||e).slice(0,3)}),Object.assign(Object.assign({},o),{verticesPositions:[(o.verticesPositions||e)[0],...(o.verticesPositions||e).slice(2,4)]})]),[]),o)}function l(t,o){const{position:e,colors:n,rotation:i,size:r}=t,a=[[0,0,0],[0,r.y,0],[r.x,r.y,0],[r.x,0,0],[0,0,r.z],[0,r.y,r.z],[r.x,r.y,r.z],[r.x,0,r.z]];return[{position:[e[0],e[1],e[2]],verticesPositions:[a[0],a[3],a[7],a[4]],rotation:i,color:n[0]},{position:[e[0],e[1],e[2]],verticesPositions:[a[0],a[1],a[5],a[4]],rotation:i,color:n[1]},{position:[e[0],e[1],e[2]],verticesPositions:a.slice(0,4),rotation:i,color:n[2]},{position:[e[0],e[1],e[2]],verticesPositions:[a[3],a[2],a[6],a[7]],rotation:{x:i.x,y:i.y,z:i.z},color:n[3]},{position:[e[0],e[1],e[2]],verticesPositions:[a[1],a[2],a[6],a[5]],rotation:i,color:n[4]},{position:[e[0],e[1],e[2]],verticesPositions:a.slice(4,8),rotation:i,color:n[5]}].map((t=>c([t],o)))}const h={"2d":{Triangle:s,Quadrilateral:c},"3d":{Hexahedron:l,Cube:function(t,o){const{size:e}=t;return l(Object.assign(Object.assign({},t),{size:{x:e,y:e,z:e}}),o)}},render(t,e,n,i,a){const s=e=>{var s,c,l;t.renderTriangles(e,n,i,(s=a,c=e.position,l=e.rotation,s=o.translate(s,c[0],c[1],c[2]),s=o.xRotate(s,r(l.y)),s=o.yRotate(s,r(l.x)),o.zRotate(s,r(l.z))))};Array.isArray(e)?e.map(s):s(e)}};class u{constructor(t){this.$container=document.querySelector(`#${t}`)}render(){this.$container.innerHTML=`\n  <h1>Rubik's Cube</h1>\n  \n  <canvas id="scene"></canvas>\n\n  <p>\n    FaceMap\n    <pre id="test"></pre>\n  </p>\n  \n  <div id="controls">\n    <button class="scramble-controls">Scramble</button>\n\n    <div class="rotation-controls">\n      <div>\n        <button class="rotation-controls__button rotation-controls__button--up-left">&#9700;</button>\n        <button class="rotation-controls__button rotation-controls__button--up">&#9650;</button>\n        <button class="rotation-controls__button rotation-controls__button--up-right">&#9701;</button>\n      </div>\n      <div>\n        <button class="rotation-controls__button rotation-controls__button--left">&#9664;</button>\n        <button class="rotation-controls__button rotation-controls__button--down">&#9660;</button>\n        <button class="rotation-controls__button rotation-controls__button--right">&#9654;</button>\n      </div>\n    </div>\n\n    <p>Move:</p>\n    <div class="move-controls">\n      <select class="move-controls__direction">\n        <option value="up">Up</option>\n        <option value="down">Down</option>\n        <option value="left">Left</option>\n        <option value="right">Right</option>\n      </select>\n      <div class="move-controls__position">\n        ${Array(3).fill(0).reduce(((t,o,e)=>t+`<button class="move-controls__position-button" position-index="${e}">${e+1}</button>`),"")}\n      </div>\n    </div>\n  <div>\n\n  <style>\n    #controls {\n      margin-top: 2rem;\n      font-size: 1.75rem;\n    }\n    .rotation-controls,\n    .move-controls {\n      display: flex;\n      flex-flow: column wrap;\n      align-content: center;\n      justify-content: center;\n      margin-left: auto;\n      margin-right: auto;\n      margin-top: 1rem;\n    }\n\n    .rotation-controls {\n      margin-bottom: 2rem;\n    }\n \n    .rotation-controls__button {\n      font-size: 1.5rem;\n    }\n\n    \n    .move-controls > * {\n      margin-bottom: 1rem;\n    }\n    .move-controls__position-button {\n      margin: 0.25rem;\n    }\n  </style>\n    `}}const p=class{static rotateZ(t,o){let e=null;return e=t?(t,o,e)=>{t[o[0]][Math.abs(o[1]-2)]=e}:(t,o,e)=>{t[Math.abs(o[0]-2)][o[1]]=e},[...o.map((t=>[...t]))].reduce(((t,o,n)=>(o.map(((o,i)=>{e(t,[i,n],o)})),t)),[[void 0,void 0,void 0],[void 0,void 0,void 0],[void 0,void 0,void 0]])}};var d,v;!function(t){t[t.None=0]="None",t[t.White=1]="White",t[t.Orange=2]="Orange",t[t.Green=3]="Green",t[t.Red=4]="Red",t[t.Yellow=5]="Yellow",t[t.Blue=6]="Blue"}(d||(d={})),function(t){t[t.Up=0]="Up",t[t.Left=1]="Left",t[t.Front=2]="Front",t[t.Right=3]="Right",t[t.Down=4]="Down",t[t.Back=5]="Back"}(v||(v={}));const x=class{constructor(){this.position=[0,0,0],this.rotation={x:0,y:0,z:0},this.faceMap={up:v.Up,down:v.Down,front:v.Front,back:v.Back,left:v.Left,right:v.Right},this.movableFaces={x:[v.Left,v.Front,v.Right,v.Back],y:[v.Up,v.Front,v.Down,v.Back],z:[v.Up,v.Right,v.Down,v.Left]},this.adjacentFaces={x:[v.Up,v.Down],y:[v.Right,v.Left],z:[v.Back,v.Front]},this.data=Array(6).fill(null).map(((t,o)=>Array(3).fill(0).map((()=>Array(3).fill(Object.keys(d)[o+1])))))}get faceMap2D(){return[[null,this.faceMap.up,null],[this.faceMap.left,this.faceMap.front,this.faceMap.right],[null,this.faceMap.down,null],[null,this.faceMap.back,null]]}scramble(t){const o=()=>["x","y"][Math.floor(2*Math.random())],e=()=>Math.floor(1*Math.random())?-1:1;Array(t).fill(0).map(((t,n)=>{this.move({[o()]:e},Math.floor(3*Math.random()))}))}rotate(t){const o=t.x?"x":t.y?"y":t.z?"z":null;o&&t[o]&&(this.rotateMovableFaces(o,t[o]),this.rotateAdjacentFaces(o,t[o]))}move(t,o){const e=t.x?"x":t.y?"y":t.z?"z":null;e&&t[e]&&(this.moveMovableFaces(e,t[e],o),this.moveAdjacentFaces(e,t[e],o))}rotateMovableFaces(t,o){const e=[...this.movableFaces[t]],n=0<o?[...e.slice(1,4),e[0]]:[e[e.length-1],...e.slice(0,3)],i=e.map((t=>this.getFaceMapLocation(t))),r=[...this.data];i.map(((t,o)=>{this.data[this.faceMap[t]]=r[n[o]],this.faceMap[t]=n[o]}))}rotateAdjacentFaces(t,o){const e=0<o;[...this.adjacentFaces[t]].map(((t,o)=>{const n=this.getFaceMapLocation(t);this.data[this.faceMap[n]]=p.rotateZ(o?e:!e,this.data[this.faceMap[n]])}))}moveMovableFaces(t,o,e){const n=this.movableFaces[t].map((t=>this.getFaceMapLocation(t))),i=n.map((o=>{switch(t){case"x":return Array(3).fill(0).map(((t,n)=>"back"!==o?[e,n]:[2-e,2-n]));case"y":return Array(3).fill(0).map(((t,o)=>[o,e]));case"z":switch(o){case"up":return Array(3).fill(0).map(((t,o)=>[o,2-e]));case"left":return Array(3).fill(0).map(((t,o)=>[2-e,2-o]));case"down":return Array(3).fill(0).map(((t,o)=>[2-o,e]));case"right":return Array(3).fill(0).map(((t,o)=>[e,o]))}default:return null}})),r=i.map(((t,o)=>{const e=this.faceMap[n[o]];return t.map((t=>this.data[e][t[1]][t[0]]))})),a=0<o?[...r.slice(1,4),r[0]]:[r[r.length-1],...r.slice(0,3)];n.map(((t,o)=>{const e=i[o],n=this.faceMap[t];e.map(((t,e)=>{this.data[n][t[1]][t[0]]=a[o][e]}))}))}moveAdjacentFaces(t,o,e){let n=null;if(0===e?n=this.adjacentFaces[t]["x"===t?0:1]:2===e&&(n=this.adjacentFaces[t]["x"===t?1:0]),null===n)return;const i=this.getFaceMapLocation(n),r=this.faceMap[i];this.data[r]=p.rotateZ(0===e?0<o:!(0<o),this.data[r])}getFaceMapLocation(t){const o=Object.values(this.faceMap).findIndex((o=>t===o));return-1===o?null:Object.keys(this.faceMap)[o]}},m={width:600,height:400,pixelSize:100,spacing:10,backgroundColor:[.5,.5,.5,1]},b={radius:500,aspect:m.width/m.height,zNear:1,zFar:2e3,fieldOfView:r(70),angle:r(-22.5)},f={WHITE:[1,1,1,1],GREEN:[0,1,0,1],RED:[1,0,0,1],ORANGE:[1,.5,0,1],YELLOW:[1,1,0,1],BLUE:[0,.5,1,1]},y=class{constructor(t,o,e,n){this.$container=t,this.$rotationControls=o,this.$moveControls=e,this.$scrambleControls=n,this.setRotationEvents(),this.setMoveEvents(),this.setScrambleEvents()}setScrambleEvents(){this.$scrambleControls.addEventListener("click",(()=>{this.dispatchEvent("scramble",null)}))}setMoveEvents(){this.$moveControls.positions.map((t=>{t.addEventListener("click",(o=>{const e=this.$moveControls.direction.value,n=Number(t.getAttribute("position-index"));e&&!isNaN(n)&&this.dispatchEvent("move",{direction:e,positionIndex:n})}))}))}setRotationEvents(){Object.keys(this.$rotationControls).map((t=>{this.$rotationControls[t].addEventListener("click",(t=>{if(t.target)switch(t.target){case this.$rotationControls.up:this.dispatchEvent("rotate","up");break;case this.$rotationControls.left:this.dispatchEvent("rotate","left");break;case this.$rotationControls.right:this.dispatchEvent("rotate","right");break;case this.$rotationControls.down:this.dispatchEvent("rotate","down");break;case this.$rotationControls.upLeft:this.dispatchEvent("rotate","upLeft");break;case this.$rotationControls.upRight:this.dispatchEvent("rotate","upRight")}}))}))}dispatchEvent(t,o){const e=new CustomEvent(t,{detail:o});this.$container.dispatchEvent(e)}};window.addEventListener("DOMContentLoaded",(()=>{const t=new u("app-container");t.render();const n=t.$container.querySelector("#test"),r=t.$container.querySelector("#scene"),a=t.$container.querySelector("#controls"),s=new e(r,{width:m.width,height:m.height,backgroundColor:m.backgroundColor}),c=new y(a,{up:a.querySelector(".rotation-controls__button--up"),left:a.querySelector(".rotation-controls__button--left"),right:a.querySelector(".rotation-controls__button--right"),down:a.querySelector(".rotation-controls__button--down"),upLeft:a.querySelector(".rotation-controls__button--up-left"),upRight:a.querySelector(".rotation-controls__button--up-right")},{direction:a.querySelector(".move-controls__direction"),positions:Array(3).fill(0).map(((t,o)=>a.querySelector(`.move-controls__position-button[position-index="${o}"]`)))},a.querySelector(".scramble-controls")),l=o.perspective(b.fieldOfView,b.aspect,b.zNear,b.zFar),p=o.inverse(o.translate(o.yRotation(b.angle),m.pixelSize/2,-m.pixelSize/2,1.5*b.radius)),d=o.multiply(l,p);let g=new x;g.data.map(((t,o)=>{t.map(((t,e)=>{t.map(((t,n)=>{0===e&&0===n&&(g.data[o][e][n]=1)}))}))})),c.$container.addEventListener("rotate",(t=>{switch(t.detail||""){case"up":g.rotate({y:1});break;case"left":g.rotate({x:1});break;case"right":g.rotate({x:-1});break;case"down":g.rotate({y:-1});break;case"upLeft":g.rotate({z:1});break;case"upRight":g.rotate({z:-1})}})),c.$container.addEventListener("move",(t=>{if(!t.detail)return;const{direction:o,positionIndex:e}=t.detail;let n={};switch(o){case"up":n.y=1;break;case"left":n.x=1;break;case"right":n.x=-1;break;case"down":n.y=-1}g.move(n,e)})),c.$container.addEventListener("scramble",(()=>{g.scramble(100)}));let _=0;const z=()=>{if(_>0){s.clearCanvas();const t=function(t,o,e,n,i){const r=3*t+4*o;return[(a,s,c)=>{const l={x:-t+o,y:-o,z:0},u={x:l.x+c*(t+o)-o,y:l.y,z:l.z+r-(s*(t+o)+o)};return h["2d"].Quadrilateral([{position:e,verticesPositions:[[u.x,u.y,u.z],[u.x,u.y,u.z-t],[u.x+t,u.y,u.z-t],[u.x+t,u.y,u.z]],rotation:n,color:i[0][a]}],3)},(a,s,c)=>{const l={x:-t-o,y:o,z:0},u={x:l.x,y:l.y+s*(t+o)-o,z:l.z+r-(c*(t+o)+o)};return h["2d"].Quadrilateral([{position:e,verticesPositions:[[u.x,u.y,u.z],[u.x,u.y,u.z-t],[u.x,u.y+t,u.z-t],[u.x,u.y+t,u.z]],rotation:n,color:i[1][a]}],3)},(r,a,s)=>{const c={x:s*(t+o),y:a*(t+o),z:0};return h["2d"].Quadrilateral([{position:e,verticesPositions:[[c.x,c.y,c.z],[c.x-t,c.y,c.z],[c.x-t,c.y+t,c.z],[c.x,c.y+t,c.z]],rotation:n,color:i[2][r]}],3)},(a,s,c)=>{const l={x:-t-o+r,y:o+s*(t+o)-o,z:t+o+r-((3-c)*(t+o)+o)};return h["2d"].Quadrilateral([{position:e,verticesPositions:[[l.x,l.y,l.z],[l.x,l.y,l.z-t],[l.x,l.y+t,l.z-t],[l.x,l.y+t,l.z]],rotation:n,color:i[3][a]}],3)},(a,s,c)=>{const l={x:-t+o+c*(t+o)-o,y:0+r-o,z:t+o+r-((3-s)*(t+o)+o)};return h["2d"].Quadrilateral([{position:e,verticesPositions:[[l.x,l.y,l.z],[l.x,l.y,l.z-t],[l.x+t,l.y,l.z-t],[l.x+t,l.y,l.z]],rotation:n,color:i[4][a]}],3)},(a,s,c)=>{const l={x:o+c*(t+o)-o,y:(3-s)*(t+o)-t-o,z:0+r};return h["2d"].Quadrilateral([{position:e,verticesPositions:[[l.x,l.y,l.z],[l.x-t,l.y,l.z],[l.x-t,l.y+t,l.z],[l.x,l.y+t,l.z]],rotation:n,color:i[5][a]}],3)}].reduce(((t,o)=>[...t,...Array(9).fill(0).map(((t,e)=>o(e,e%3,Math.floor(e/3))))]),[])}(m.pixelSize,m.spacing,g.position,g.rotation,g.data.map((t=>t.reduce(((t,o)=>[...t,...o.map((t=>Object.values(f)[Number(t)-1]))]),[]))));n.innerText=g.faceMap2D.reduce(((t,o)=>t+o.map((t=>typeof v.Up==typeof t?t:" ")).join(" ")+"\n"),""),h.render(s,[...t],i.vertexShader,i.fragmentShader,d)}_=requestAnimationFrame(z)};requestAnimationFrame(z)}))})();